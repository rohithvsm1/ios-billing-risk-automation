name: iOS Build CI/CD (Target Direct)
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-ios:
    runs-on: macos-15
    
    steps:
    - uses: actions/checkout@v4
    
    - name: List Xcode Projects
      run: find . -name "*.xcodeproj" -o -name "*.xcworkspace"
    
    - name: Build Main Target (No Scheme)
      run: |
        xcodebuild build \
          -project InvoiceRiskDetector.xcodeproj \
          -target InvoiceRiskDetector \
          -sdk iphonesimulator \
          -configuration Debug \
          -derivedDataPath DerivedData
    
    - name: Verify Build Products
      run: |
        echo "=== BUILT APPS ==="
        find DerivedData -name "*.app" -o -name "*.ipa"
        ls -la DerivedData/Build/Products/
    
    - name: Upload iOS App
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: ios-simulator-app
        path: DerivedData/Build/
